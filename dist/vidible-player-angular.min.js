"use strict";!function(e){var i=e.module("ngLoadScript",[]);i.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,i,t){if("text/javascript-lazy"===t.type){var n=document.createElement("script");n.type="text/javascript";var d=i.attr("src");if(void 0!==d)n.src=d;else{var r=i.text();n.text=r}document.head.appendChild(n),i.remove()}}}})}(angular),function(e){e.module("vidible-module",[]).service("VidibleQueueLoader",["$http","$timeout",function(i,t){function n(e,t,n,d){var r="http://delivery.vidible.tv/jsonp/pid="+t+"/vid="+e+"/"+n+".js";i.get(r).then(function(e){d(e.status,e.data)},function(e){d(e.status,null)})}function d(e,i,n){if(l||(l=(new Date).getTime()),e.vdb_Player)i(e.vdb_Player),l=null;else{var r=(new Date).getTime(),o=r-l;if(o>=n)return console.error("Timeout while waiting to vidible script to load..."),console.log(e),void(l=null);t(function(){d(e,i,n)},0)}}function r(){if(a.length>0){var i=a.shift(),t=angular.element('<div class="player vdb_player"></div>');n(i.vidOptions.videoId,i.vidOptions.vidiblePlayerId,i.vidOptions.vidibleAccountId,function(n,l){if(200===n){var u=e.element(t),a=document.createElement("script");u.addClass("vdb_"+i.vidOptions.vidiblePlayerId+i.vidOptions.vidibleAccountId),a.innerText=l,t[0].appendChild(a),i.elem.append(t),d(t[0],function(e){i.cb(e),r()},o)}else console.error("Error loading vidable with id = "+i.vid),r()})}}var l,o=3e4,u={},a=[];return l=null,u.queueForProcessing=function(e,i,t,n,d){a.push({vidOptions:{videoId:e,vidiblePlayerId:i,vidibleAccountId:t},elem:n,cb:d}),a.length>1||r()},u}]).directive("vidiblePlayer",["$window","$interval","VidibleQueueLoader",function(e,i,t){function n(i){switch(i){case e.vidible.PLAYER_READY:return d+"ready";case e.vidible.VIDEO_END:return d+"ended";case e.vidible.VIDEO_PAUSE:return d+"paused";case e.vidible.VIDEO_PLAY:return d+"playing";case e.vidible.VIDEO_DATA_LOADED:return d+"loaded";case e.vidible.VIDEO_TIMEUPDATE:return d+"timeUpdate"}}var d="vidible.player.",r="vidible.player.ready",l=1;return{restrict:"EA",scope:{videoId:"=videoId",player:"=?player",playerId:"@playerId",vidiblePlayerId:"@vidiblePlayerId",vidibleAccountId:"@vidibleAccountId"},link:function(e,o,u){function a(){var i=Array.prototype.slice.call(arguments);e.$emit.apply(e,i)}function c(e,i){[vidible.PLAYER_READY,vidible.VIDEO_DATA_LOADED,vidible.VIDEO_PLAY,vidible.VIDEO_PAUSE,vidible.VIDEO_END,vidible.VIDEO_TIMEUPDATE].forEach(function(t){i.addEventListener(t,function(d){a(n(t),e,i,d)})})}function v(){e.player&&e.player.getVidiblePlayer()&&e.player.getVidiblePlayer().destroy(),o.empty()}function s(e){var t,n=e.isMuted();return i(function(){var i=e.isMuted();void 0!==i&&(void 0!==n&&n!==i&&(t=d+(i?"muted":"unmuted"),a(t,e,{muted:i})),n=i)},100)}function p(t){var n={getVidiblePlayer:function(){return t},getVidibleElement:function(){return o[0].querySelector(".vdb_player")},pause:function(){t.pause()},play:function(){t.play()},replay:function(){t.seekTo(0),t.play()},mute:function(){t.mute()},unmute:function(){e.player.isMuted()&&t.mute()},getVolume:function(){try{return t.getPlayerInfo().volume}catch(e){return void 0}},setVolume:function(e){return t.volume(e)},isMuted:function(){var e=n.getVolume();return void 0===e||null===e?void 0:0===e},destroy:function(){console.warn("Player is not yet ready. nothing to destroy...")}};e.player=n,c(n,t),e.$on(r,function(e,t){if(t===n){var d=s(n);n.destroy=function(){i.cancel(d),v()}}})}function f(i){v(),t.queueForProcessing(i,e.vidiblePlayerId,e.vidibleAccountId,o,p)}var y,b=o[0].id||u.playerId||"page-unique-vidible-id-"+l++;o[0].id=b,y=e.$watch(function(){return"undefined"!=typeof e.videoId},function(i){i&&(y(),e.$watch("videoId",function(){f(e.videoId)}))}),e.$on("$destroy",function(){v()})}}}])}(angular);