!function(e){"use strict";var t=e.module("ngLoadScript",[]);t.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,t,i){if("text/javascript-lazy"===i.type){var n=document.createElement("script");n.type="text/javascript";var r=t.attr("src");if(void 0!==r)n.src=r;else{var a=t.text();n.text=a}document.head.appendChild(n),t.remove()}}}})}(angular),function(e){"use strict";e.module("vidible-module",[]).service("vidibleQueueLoader",["$http","$timeout",function(t,i){function n(e,i){var n="http://delivery.vidible.tv/jsonp/pid=55c8aae9e4b0ca68372fb553/vid="+e+"/55af9dcae4b02944c03a2eee.js";t.get(n).then(function(e){i(e.status,"<script>"+e.data+"</script>")},function(e){i(e.status,null)})}function r(e,t,n){if(u||(u=(new Date).getTime()),e.vdb_Player)t(e.vdb_Player),u=null;else{var a=(new Date).getTime(),o=a-u;if(o>=n)return console.error("timout while waiting to vidible script to load..."),console.log(e),void(u=null);i(function(){r(e,t,n)},0)}}function a(){if(c.length>0){var t=c.shift(),i=t.elem;n(t.vid,function(n,o){if(200==n){var c=e.element(i);c.addClass("vdb_55c8aae9e4b0ca68372fb55355af9dcae4b02944c03a2eee"),c.append(o),r(i,function(){a()},d)}else console.error("Error loading vidable with id = "+t.vid),a()})}}var o={},d=5e3,c=[],u=null;return o.queueForProcessing=function(e,t){c.push({vid:t,elem:e}),c.length>1||a()},o}]).directive("vidiblePlayer",["$timeout","vidibleQueueLoader",function(e,t){var i=1;return{restrict:"EA",scope:{videoId:"=videoId",playerId:"@playerId"},link:function(e,n,r){function a(e){o();var i=angular.element('<div class="player vdb_player"></div>');n.append(i),t.queueForProcessing(i,e)}function o(){e.player&&e.player.destroy(),n.empty()}var d=n[0].id||r.playerId||"page-unique-vidible-id-"+i++;n[0].id=d;var c=e.$watch(function(){return"undefined"!=typeof e.videoId},function(t){t&&(c(),e.$watch("videoId",function(){a(e.videoId)}))});e.$on("$destroy",function(){o()})}}}])}(angular);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItbG9hZHNjcmlwdC5qcyIsInZpZGlibGUtcGxheWVyLmpzIl0sIm5hbWVzIjpbIm5nIiwiYXBwIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJzY29wZSIsImxpbmsiLCJlbGVtIiwiYXR0ciIsInR5cGUiLCJzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwidW5kZWZpbmVkIiwiY29kZSIsInRleHQiLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJyZW1vdmUiLCJhbmd1bGFyIiwic2VydmljZSIsIiRodHRwIiwiJHRpbWVvdXQiLCJsb2FkU2NyaXB0QnlWaWRlb0lkIiwidmlkZW9JZCIsImNhbGxiYWNrIiwidmlkaWJsZVNjcmlwdFVybCIsImdldCIsInRoZW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImRhdGEiLCJ3YWl0Rm9yUGxheWVyVG9CZVJlYWR5IiwiZGl2IiwiY2IiLCJ0aW1lb3V0Iiwic3RyYXRlZFdhaXRpbmciLCJEYXRlIiwiZ2V0VGltZSIsInZkYl9QbGF5ZXIiLCJub3ciLCJ0aW1lIiwiY29uc29sZSIsImVycm9yIiwibG9nIiwicHJvY2Vzc1F1ZXVlIiwicXVldWUiLCJsZW5ndGgiLCJpdGVtIiwic2hpZnQiLCJ2aWRpYmxlRWxlbWVudCIsInZpZCIsInN0YXR1c0NvZGUiLCJzY3JpcHQiLCJ2aWRFbGVtZW50IiwiZWxlbWVudCIsImFkZENsYXNzIiwiYXBwZW5kIiwidmlkZW9SZWFkeXRpbWVvdXQiLCJWaWRpYmxlTG9hZGVyUXVldWUiLCJxdWV1ZUZvclByb2Nlc3NpbmciLCJwdXNoIiwidmlkaWJsZVF1ZXVlTG9hZGVyIiwicGFnZVVuaXF1ZUlkIiwicGxheWVySWQiLCJhdHRycyIsImNyZWF0ZVBsYXllciIsImRlc3Ryb3lQbGF5ZXIiLCJwbGF5ZXIiLCJkZXN0cm95IiwiZW1wdHkiLCJpZCIsInN0b3BXYXRjaGluZ1JlYWR5IiwiJHdhdGNoIiwicmVhZHkiLCIkb24iXSwibWFwcGluZ3MiOiJD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UixZQU1BaEQiLCJmaWxlIjoidmlkaWJsZS1wbGF5ZXItYW5ndWxhci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogIEFuZ3VsYXIgTG9hZFNjcmlwdFxuICpcbiAqICBMZXQgYW5ndWxhciBsb2FkIGFuZCBleGVjdXRlIGxhenkgamF2YXNjcmlwdCBmcm9tIHBhcnRpYWxzIVxuICpcbiAqICBUaGlzIG1vZHVsZSBpcyB0aGUgcmVzdWx0IG9mICB0aGlzIGlzc3VlOiBcIjEuMi4wcmMxIHJlZ3Jlc3Npb246IHNjcmlwdCB0YWdzIG5vdCBsb2FkZWQgdmlhIG5nSW5jbHVkZVwiXG4gKiAgSXNzdWUgdXJsOiBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyLmpzL2lzc3Vlcy8zNzU2XG4gKlxuICogIEFzIG9mIEFuZ3VsYXIgMS4yLjAgdGhlIG5nSW5jbHVkZSBzY3JpcHRzIGRvZXMgbm90IHBlcm1pdCBleGVjdXRpb24gb2YgamF2YXNjcmlwdCBmcm9tIGluY2x1ZGVkIHBhcnRpYWxzLlxuICogIFRoaXMgbGl0dGxlIG1vZHVsZSBleGVjdXRlIGNvZGUgaW5zaWRlIHNjcmlwdCB0YWdzIHdpdGggXCJqYXZhc2NyaXB0LWxhenlcIiBhdHRyaWJ1dGUgYWZ0ZXIgcGFydGlhbCBsb2FkaW5nLFxuICogIHRodXMgcmUtZW5hYmxpbmcgdGhpcyBmZWF0dXJlLlxuICpcbiAqICAoIHBsZWFzZSBoYXZlIGEgbG9vayBhdCB0aGUgaXNzdWUgY29tbWVudHMsIHRoaXMgYW5ndWxhciBmZWF0dXJlIHdhcyBuZXZlciBwbGFubmVkIG5vciBpbmNsdWRlZCBwcm9wZXJseSxcbiAqICB3YXMgb25seSBhIGRyYXdiYWNrIG9mIHVzaW5nIGpRdWVyeSBmb3IgcGFydGlhbCBpbmNsdXNpb24gKVxuICpcbiAqICBUaGlzIGFuZ3VsYXIgbW9kdWxlIGhhdmUgYmVlbiBjcmVhdGVkIGJ5IEBlbmRvcmFtYSAoaHR0cHM6Ly9naXRodWIuY29tL2VuZG9yYW1hKSBiYXNlZCB1cG9uIHRoZSBjb2RlXG4gKiAgcG9zdGVkIGJ5IEBvbG9zdGFuIChodHRwczovL2dpdGh1Yi5jb20vb2xvc3RhbilcbiAqXG4gKiAgU2ltcGx5IGFkZCB0aGlzIGZpbGUsIGxvYWQgbmdMb2FkU2NyaXB0IG1vZHVsZSBhcyBhcHBsaWNhdGlvbiBkZXBlbmRlbmN5IGFuZCB1c2UgdHlwZT1cInRleHQvamF2YXNjcmlwdC1sYXp5XCJcbiAqICBhcyB0eXBlIGZvciBzY3JpcHQgeW91IHdoaWNoIHRvIGxvYWQgbGF6aWx5IGluIHBhcnRpYWxzLlxuICpcbiAqIExpY2Vuc2U6IDIwMTMgLSByZWxlYXNlZCB0byB0aGUgUHVibGljIERvbWFpbi5cbiAqL1xuXG4vKmdsb2JhbCBhbmd1bGFyICovXG4oZnVuY3Rpb24gKG5nKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGFwcCA9IG5nLm1vZHVsZSgnbmdMb2FkU2NyaXB0JywgW10pO1xuXG4gICAgYXBwLmRpcmVjdGl2ZSgnc2NyaXB0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0sIGF0dHIpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYgKGF0dHIudHlwZT09PSd0ZXh0L2phdmFzY3JpcHQtbGF6eScpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gICAgICAgICAgICAgICAgICAgIHMudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCI7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzcmMgPSBlbGVtLmF0dHIoJ3NyYycpO1xuICAgICAgICAgICAgICAgICAgICBpZihzcmMhPT11bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHMuc3JjID0gc3JjO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvZGUgPSBlbGVtLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHMudGV4dCA9IGNvZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG5cbn0oYW5ndWxhcikpOyIsIi8qKlxuICogQ3JlYXRlZCBieSB0b21lcnNlbGEgb24gOC8xMy8xNS5cbiAqL1xuXG4oZnVuY3Rpb24gKG5nKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgbmcubW9kdWxlKCd2aWRpYmxlLW1vZHVsZScsIFtdKVxuICAgICAgICAuc2VydmljZSgndmlkaWJsZVF1ZXVlTG9hZGVyJywgWyckaHR0cCcsICckdGltZW91dCcsIGZ1bmN0aW9uICgkaHR0cCwgJHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHZhciBWaWRpYmxlTG9hZGVyUXVldWUgPSB7fTtcbiAgICAgICAgICAgIHZhciB2aWRlb1JlYWR5dGltZW91dCA9IDUwMDA7XG4gICAgICAgICAgICB2YXIgcXVldWUgPSBbXTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gbG9hZFNjcmlwdEJ5VmlkZW9JZCh2aWRlb0lkLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHZhciB2aWRpYmxlU2NyaXB0VXJsID0gJ2h0dHA6Ly9kZWxpdmVyeS52aWRpYmxlLnR2L2pzb25wL3BpZD01NWM4YWFlOWU0YjBjYTY4MzcyZmI1NTMvdmlkPScgK1xuICAgICAgICAgICAgICAgICAgICB2aWRlb0lkICsgJy81NWFmOWRjYWU0YjAyOTQ0YzAzYTJlZWUuanMnO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHZpZGlibGVTY3JpcHRVcmwpLlxuICAgICAgICAgICAgICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5zdGF0dXMsICc8c2NyaXB0PicgKyByZXNwb25zZS5kYXRhICsgJzwvc2NyaXB0PicpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2Uuc3RhdHVzLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzdHJhdGVkV2FpdGluZyA9IG51bGw7XG4gICAgICAgICAgICBmdW5jdGlvbiB3YWl0Rm9yUGxheWVyVG9CZVJlYWR5KGRpdiwgY2IsIHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBhZGQgdGltZW91dCBvcHRpb24gYW5kIGJyb2FkY2FzdCBlcnJvciBpbiBjYXNlIG9mIHRpbWVvdXRcbiAgICAgICAgICAgICAgICBpZiAoIXN0cmF0ZWRXYWl0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWRXYWl0aW5nID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkaXYudmRiX1BsYXllcikge1xuICAgICAgICAgICAgICAgICAgICBjYihkaXYudmRiX1BsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWRXYWl0aW5nID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lID0gbm93IC0gc3RyYXRlZFdhaXRpbmc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aW1lID49IHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3RpbW91dCB3aGlsZSB3YWl0aW5nIHRvIHZpZGlibGUgc2NyaXB0IHRvIGxvYWQuLi4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRpdik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJhdGVkV2FpdGluZyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7IHdhaXRGb3JQbGF5ZXJUb0JlUmVhZHkoZGl2LGNiLCB0aW1lb3V0KTsgfSwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBWaWRpYmxlTG9hZGVyUXVldWUucXVldWVGb3JQcm9jZXNzaW5nID0gZnVuY3Rpb24odmlkaWJsZUVsZW1lbnQsIHZpZGVvSWQpIHtcbiAgICAgICAgICAgICAgICBxdWV1ZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdmlkOiB2aWRlb0lkLFxuICAgICAgICAgICAgICAgICAgICBlbGVtOiB2aWRpYmxlRWxlbWVudFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHByb2Nlc3NRdWV1ZSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc1F1ZXVlKCkge1xuICAgICAgICAgICAgICAgIGlmIChxdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vcmVtb3ZlIGVsZW1lbnQgZnJvbSBxdWV1ZVxuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2aWRpYmxlRWxlbWVudCA9IGl0ZW0uZWxlbTtcblxuICAgICAgICAgICAgICAgICAgICBsb2FkU2NyaXB0QnlWaWRlb0lkKGl0ZW0udmlkLCBmdW5jdGlvbihzdGF0dXNDb2RlLCBzY3JpcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXNDb2RlID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2aWRFbGVtZW50ID0gbmcuZWxlbWVudCh2aWRpYmxlRWxlbWVudClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRFbGVtZW50LmFkZENsYXNzKCd2ZGJfNTVjOGFhZTllNGIwY2E2ODM3MmZiNTUzNTVhZjlkY2FlNGIwMjk0NGMwM2EyZWVlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkRWxlbWVudC5hcHBlbmQoc2NyaXB0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0Rm9yUGxheWVyVG9CZVJlYWR5KHZpZGlibGVFbGVtZW50LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBuZXh0IHZpZGVvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NRdWV1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHZpZGVvUmVhZHl0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyB2aWRhYmxlIHdpdGggaWQgPSAnICsgaXRlbS52aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NRdWV1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gVmlkaWJsZUxvYWRlclF1ZXVlO1xuICAgICAgICB9XSlcbiAgICAgICAgLmRpcmVjdGl2ZSgndmlkaWJsZVBsYXllcicsIFsnJHRpbWVvdXQnLCAndmlkaWJsZVF1ZXVlTG9hZGVyJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uKCR0aW1lb3V0LCB2aWRpYmxlUXVldWVMb2FkZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFnZVVuaXF1ZUlkID0gMTtcbiAgICAgICAgICAgICAgICB2YXIgcXVldWVkVmlkaWJsZUVsZW1lbnRzID0gMDtcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnRQcmVmaXggPSAndmlkaWJsZS5wbGF5ZXIuJztcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFZpZGlibGVFdmVudE5hbWUodmlkaWJsZUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENhbiB1c2UgdGhpcyBmdW5jdGlvbiBvbmx5IHdoZW4gYSB2aWRpYmxlIHNjcmlwdCBpcyBsb2FkZWQgKFdoZW4gdGhlIHBsYXllciBpcyBhY3RpdmUgaW4gb3VyIGNhc2UpXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmlkaWJsZUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHZpZGlibGUuUExBWUVSX1JFQURZOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudFByZWZpeCArICdyZWFkeSc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHZpZGlibGUuVklERU9fRU5EOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudFByZWZpeCArICdlbmRlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHZpZGlibGUuVklERU9fUEFVU0U6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50UHJlZml4ICsgJ3BhdXNlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHZpZGlibGUuVklERU9fUExBWTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRQcmVmaXggKyAncGxheWluZyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvSWQ6ICc9dmlkZW9JZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3BsYXllcjogJz0/cGxheWVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcklkOiAnQHBsYXllcklkJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBlbGVtZW50SWQgaWYgbm90IGFscmVhZHkgZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBsYXllcklkID0gZWxlbWVudFswXS5pZCB8fCBhdHRycy5wbGF5ZXJJZCB8fCAncGFnZS11bmlxdWUtdmlkaWJsZS1pZC0nICsgcGFnZVVuaXF1ZUlkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLmlkID0gcGxheWVySWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGJyb2FkY2FzdEV2ZW50KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRlbWl0LmFwcGx5KHNjb3BlLCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5pdFBsYXllcihwbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaW5pdFBsYXllcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBsYXllciA9IHBsYXllcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFt2aWRpYmxlLlBMQVlFUl9SRUFEWSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkaWJsZS5WSURFT19FTkQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGlibGUuVklERU9fUEFVU0UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGlibGUuVklERU9fUExBWV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24odmlkaWJsZUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcih2aWRpYmxlRXZlbnQsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm9hZGNhc3RFdmVudChnZXRWaWRpYmxlRXZlbnROYW1lKHZpZGlibGVFdmVudCksIHBsYXllciwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHdhaXRGb3JQbGF5ZXJUb0JlUmVhZHkoZGl2LCBjYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGFkZCB0aW1lb3V0IG9wdGlvbiBhbmQgYnJvYWRjYXN0IGVycm9yIGluIGNhc2Ugb2YgdGltZW91dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXYudmRiX1BsYXllcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYihkaXYudmRiX1BsYXllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7IHdhaXRGb3JQbGF5ZXJUb0JlUmVhZHkoZGl2LGNiKTsgfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBxdWV1ZVZpZGlibGVFbGVtZW50SW5zZXJ0aW9uKGNvbnRhaW5lckVsZW1lbnQsIHZpZGlibGVFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVkVmlkaWJsZUVsZW1lbnRzKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXVlZFZpZGlibGVFbGVtZW50cyA+IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyRWxlbWVudC5hcHBlbmQodmlkaWJsZUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3dhaXRGb3JQbGF5ZXJUb0JlUmVhZHkodmlkaWJsZUVsZW1lbnRbMF0sIGluaXRQbGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBsYXllcih2aWRlb0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVzdHJveSBwbGF5ZXIgaWYgZXhpc3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95UGxheWVyKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmlkaWJsZUVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoJzxkaXYgY2xhc3M9XCJwbGF5ZXIgdmRiX3BsYXllclwiPjwvZGl2PicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBuZXcgVmlkaWJsZSBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQodmlkaWJsZUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGlibGVRdWV1ZUxvYWRlci5xdWV1ZUZvclByb2Nlc3NpbmcodmlkaWJsZUVsZW1lbnQsIHZpZGVvSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBkZXN0cm95UGxheWVyKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBsYXllciAmJiBzY29wZS5wbGF5ZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBwbGF5ZXIgd2hlbiB0aGUgZGlyZWN0aXZlIHRhZyBpcyByZWFkeVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3BXYXRjaGluZ1JlYWR5ID0gc2NvcGUuJHdhdGNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2FpdCB1bnRpbCB2aWRlb0lkIGlzIGRlZmluZWQuLi5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh0eXBlb2Ygc2NvcGUudmlkZW9JZCAhPT0gJ3VuZGVmaW5lZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlYWR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFdhdGNoaW5nUmVhZHkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndmlkZW9JZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdjcmVhdGVQbGF5ZXI6IHNjb3BlLnZpZGVvSWQgPSAnICsgc2NvcGUudmlkZW9JZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVQbGF5ZXIoc2NvcGUudmlkZW9JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSk7XG59KShhbmd1bGFyKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==