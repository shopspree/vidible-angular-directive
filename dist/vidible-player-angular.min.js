!function(e){"use strict";var t=e.module("ngLoadScript",[]);t.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,t,i){if("text/javascript-lazy"===i.type){var n=document.createElement("script");n.type="text/javascript";var r=t.attr("src");if(void 0!==r)n.src=r;else{var a=t.text();n.text=a}document.head.appendChild(n),t.remove()}}}})}(angular),function(e){"use strict";e.module("vidible-module",[]).service("vidibleQueueLoader",["$http","$timeout",function(t,i){function n(e,i,n){var r="http://delivery.vidible.tv/jsonp/pid="+i+"/vid="+e+"/"+s+".js";t.get(r).then(function(e){n(e.status,"<script>"+e.data+"</script>")},function(e){n(e.status,null)})}function r(e,t,n){if(p||(p=(new Date).getTime()),e.vdb_Player)t(e.vdb_Player),p=null;else{var a=(new Date).getTime(),u=a-p;if(u>=n)return console.error("Timeout while waiting to vidible script to load..."),console.log(e),void(p=null);i(function(){r(e,t,n)},0)}}function a(e){return e?c:v}function u(){if(l.length>0){var t=l.shift(),i=angular.element('<div class="player vdb_player"></div>');n(t.vidOptions.videoId,a(t.vidOptions.autoplay),function(n,o){if(200==n){var l=e.element(i);l.addClass("vdb_"+a(t.vidOptions.autoplay)+s),i.append(o),t.elem.append(i),r(i[0],function(e){t.cb(e),u()},d)}else console.error("Error loading vidable with id = "+t.vid),u()})}}var o={},d=5e3,l=[],c="55c8aae9e4b0ca68372fb553",v="55e6e684e4b061356c07ceb6",s="55af9dcae4b02944c03a2eee",p=null;return o.queueForProcessing=function(e,t,i){l.push({vidOptions:e,elem:t,cb:i}),l.length>1||u()},o}]).directive("vidiblePlayer",["$timeout","$interval","vidibleQueueLoader",function(e,t,i){function n(e){switch(e){case vidible.PLAYER_READY:return a+"ready";case vidible.VIDEO_END:return a+"ended";case vidible.VIDEO_PAUSE:return a+"paused";case vidible.VIDEO_PLAY:return a+"playing"}}var r=1,a="vidible.player.";return{restrict:"EA",scope:{videoId:"=videoId",player:"=?",playerId:"@playerId",autoplay:"=?autoplay"},link:function(e,u,o){function d(){var t=Array.prototype.slice.call(arguments);e.$emit.apply(e,t)}function l(e,t){[vidible.PLAYER_READY,vidible.VIDEO_END,vidible.VIDEO_PAUSE,vidible.VIDEO_PLAY].forEach(function(e){t.addEventListener(e,function(i){d(n(e),t,i)})})}function c(){e.player&&e.player.getVidiblePlayer()&&e.player.getVidiblePlayer().destroy(),u.empty()}function v(e){var i=e.isMuted();return t(function(){var t=e.isMuted();if(i!==t){var n=a+(t?"muted":"unmuted");d(n,e,{muted:t})}i=t},0)}function s(i){var n={getVidiblePlayer:function(){return i},pause:function(){i.pause()},play:function(){i.play()},mute:function(){i.mute()},unmute:function(){e.player.isMuted()&&i.mute()},getVolume:function(){return i.getPlayerInfo().volume},isMuted:function(){try{return 0===i.getPlayerInfo().volume}catch(e){return void 0}}};e.player=n,l(n,i);var r=v(n);n.destroy=function(){t.cancel(r),c()}}function p(t){c(),i.queueForProcessing({videoId:t,autoplay:e.autoplay},u,s)}var f=u[0].id||o.playerId||"page-unique-vidible-id-"+r++;u[0].id=f;var y=e.$watch(function(){return"undefined"!=typeof e.videoId},function(t){t&&(y(),e.$watch("videoId",function(){p(e.videoId)}))});e.$on("$destroy",function(){c()})}}}])}(angular);