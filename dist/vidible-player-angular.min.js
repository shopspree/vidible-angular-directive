"use strict";!function(e){var n=e.module("ngLoadScript",[]);n.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,n,t){if("text/javascript-lazy"===t.type){var i=document.createElement("script");i.type="text/javascript";var r=n.attr("src");if(void 0!==r)i.src=r;else{var l=n.text();i.text=l}document.head.appendChild(i),n.remove()}}}})}(angular),function(e){e.module("vidible-module",[]).service("vidibleQueueLoader",["$http","$timeout",function(n,t){function i(e,t,i){var r="http://delivery.vidible.tv/jsonp/pid="+t+"/vid="+e+"/"+f+".js";n.get(r).then(function(e){i(e.status,e.data)},function(e){i(e.status,null)})}function r(e,n,i){if(o||(o=(new Date).getTime()),e.vdb_Player)n(e.vdb_Player),o=null;else{var l=(new Date).getTime(),u=l-o;if(u>=i)return console.error("Timeout while waiting to vidible script to load..."),console.log(e),void(o=null);t(function(){r(e,n,i)},0)}}function l(e){return e?v:s}function u(){if(a.length>0){var n=a.shift(),t=angular.element('<div class="player vdb_player"></div>');i(n.vidOptions.videoId,l(n.vidOptions.autoplay),function(i,o){if(200===i){var c=e.element(t),a=document.createElement("script");c.addClass("vdb_"+l(n.vidOptions.autoplay)+f),a.innerText=o,t[0].appendChild(a),n.elem.append(t),r(t[0],function(e){n.cb(e),u()},d)}else console.error("Error loading vidable with id = "+n.vid),u()})}}var o,c={},d=3e4,a=[],v="55c8aae9e4b0ca68372fb553",s="55e6e684e4b061356c07ceb6",f="55af9dcae4b02944c03a2eee";return o=null,c.queueForProcessing=function(e,n,t,i){a.push({vidOptions:{videoId:e,autoplay:n},elem:t,cb:i}),a.length>1||u()},c}]).factory("fullscreen",function(){return{isInFullScreen:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},removeFullScreenEventLisener:function(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)},addFullScreenEventLisener:function(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e)}}}).directive("vidiblePlayer",["$interval","vidibleQueueLoader","fullscreen",function(e,n,t){function i(e){switch(e){case vidible.PLAYER_READY:return l+"ready";case vidible.VIDEO_END:return l+"ended";case vidible.VIDEO_PAUSE:return l+"paused";case vidible.VIDEO_PLAY:return l+"playing";case vidible.VIDEO_DATA_LOADED:return l+"loaded";case vidible.VIDEO_TIMEUPDATE:return l+"timeUpdate"}}var r=1,l="vidible.player.";return{restrict:"EA",scope:{videoId:"=videoId",player:"=?",playerId:"@playerId",autoplay:"=?autoplay"},link:function(u,o,c){function d(){var e=Array.prototype.slice.call(arguments);u.$emit.apply(u,e)}function a(e,n){[vidible.PLAYER_READY,vidible.VIDEO_DATA_LOADED,vidible.VIDEO_PLAY,vidible.VIDEO_PAUSE,vidible.VIDEO_END,vidible.VIDEO_TIMEUPDATE].forEach(function(e){n.addEventListener(e,function(t){d(i(e),n,t)})})}function v(){u.player&&u.player.getVidiblePlayer()&&u.player.getVidiblePlayer().destroy(),o.empty()}function s(n){var t,i=n.isMuted();return e(function(){var e=n.isMuted();void 0!==e&&(void 0!==i&&i!==e&&(t=l+(e?"muted":"unmuted"),d(t,n,{muted:e})),i=e)},100)}function f(){if(!t.isInFullScreen()){var e=o[0].querySelector(".vdb_player"),n=e.querySelector("iframe"),i=n?n.contentDocument:null;if(!i)return;var r=i.querySelector("#AolHtml5Player");r&&(r.style.width="100%",r.style.height="100%")}}function m(){t.addFullScreenEventLisener(f)}function p(){t.removeFullScreenEventLisener(f)}function y(n){var t,r={getVidiblePlayer:function(){return n},pause:function(){n.pause()},play:function(){n.play()},replay:function(){u.autoplay=!0,E(u.videoId)},mute:function(){n.mute()},unmute:function(){u.player.isMuted()&&n.mute()},getVolume:function(){return n.getPlayerInfo().volume},isMuted:function(){var e=n.getPlayerInfo().volume;return void 0===e||null===e?void 0:0===n.getPlayerInfo().volume}};u.player=r,a(r,n),u.$on(i(vidible.PLAYER_READY),function(){t=s(r),m(),r.destroy=function(){e.cancel(t),p(),v()}})}function E(e){v(),n.queueForProcessing(e,u.autoplay,o,y)}function b(){o.innerHTML=""}function g(e){e?E(e):b()}var I,h=o[0].id||c.playerId||"page-unique-vidible-id-"+r++;o[0].id=h,I=u.$watch(function(){return"undefined"!=typeof u.videoId},function(e){e&&(I(),u.$watch("videoId",function(){if(t.isInFullScreen()){var e=function(){t.removeFullScreenEventLisener(e),g(u.videoId)};t.addFullScreenEventLisener(e)}else g(u.videoId)}))}),u.$on("$destroy",function(){v()})}}}])}(angular);