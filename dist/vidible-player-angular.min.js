!function(e){"use strict";var n=e.module("ngLoadScript",[]);n.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,n,t){if("text/javascript-lazy"===t.type){var i=document.createElement("script");i.type="text/javascript";var r=n.attr("src");if(void 0!==r)i.src=r;else{var l=n.text();i.text=l}document.head.appendChild(i),n.remove()}}}})}(angular),function(e){"use strict";e.module("vidible-module",[]).service("vidibleQueueLoader",["$http","$timeout",function(n,t){function i(e,t,i){var r="http://delivery.vidible.tv/jsonp/pid="+t+"/vid="+e+"/"+s+".js";n.get(r).then(function(e){i(e.status,"<script>"+e.data+"</script>")},function(e){i(e.status,null)})}function r(e,n,i){if(f||(f=(new Date).getTime()),e.vdb_Player)n(e.vdb_Player),f=null;else{var l=(new Date).getTime(),u=l-f;if(u>=i)return console.error("Timeout while waiting to vidible script to load..."),console.log(e),void(f=null);t(function(){r(e,n,i)},0)}}function l(e){return e?d:v}function u(){if(a.length>0){var n=a.shift(),t=angular.element('<div class="player vdb_player"></div>');i(n.vidOptions.videoId,l(n.vidOptions.autoplay),function(i,o){if(200==i){var a=e.element(t);a.addClass("vdb_"+l(n.vidOptions.autoplay)+s),t.append(o),n.elem.append(t),r(t[0],function(e){n.cb(e),u()},c)}else console.error("Error loading vidable with id = "+n.vid),u()})}}var o={},c=5e3,a=[],d="55c8aae9e4b0ca68372fb553",v="55e6e684e4b061356c07ceb6",s="55af9dcae4b02944c03a2eee",f=null;return o.queueForProcessing=function(e,n,t,i){a.push({vidOptions:{videoId:e,autoplay:n},elem:t,cb:i}),a.length>1||u()},o}]).factory("fullscreen",function(){return{isInFullScreen:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},removeFullScreenEventLisener:function(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)},addFullScreenEventLisener:function(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e)}}}).directive("vidiblePlayer",["$timeout","$interval","vidibleQueueLoader","fullscreen",function(e,n,t,i){function r(e){switch(e){case vidible.PLAYER_READY:return u+"ready";case vidible.VIDEO_END:return u+"ended";case vidible.VIDEO_PAUSE:return u+"paused";case vidible.VIDEO_PLAY:return u+"playing";case vidible.VIDEO_DATA_LOADED:return u+"loaded";case vidible.VIDEO_TIMEUPDATE:return u+"timeUpdate"}}var l=1,u="vidible.player.";return{restrict:"EA",scope:{videoId:"=videoId",player:"=?",playerId:"@playerId",autoplay:"=?autoplay"},link:function(e,o,c){function a(){var n=Array.prototype.slice.call(arguments);e.$emit.apply(e,n)}function d(e,n){[vidible.PLAYER_READY,vidible.VIDEO_DATA_LOADED,vidible.VIDEO_PLAY,vidible.VIDEO_PAUSE,vidible.VIDEO_END,vidible.VIDEO_TIMEUPDATE].forEach(function(e){n.addEventListener(e,function(t){a(r(e),n,t)})})}function v(){e.player&&e.player.getVidiblePlayer()&&e.player.getVidiblePlayer().destroy(),o.empty()}function s(e){var t=e.isMuted();return n(function(){var n=e.isMuted();if(void 0!=n){if(void 0!==t&&t!==n){var i=u+(n?"muted":"unmuted");a(i,e,{muted:n})}t=n}},0)}function f(){if(!i.isInFullScreen()){var e=o[0].querySelector(".vdb_player"),n=e.querySelector("iframe"),t=n?n.contentDocument:null;if(!t)return;var r=t.querySelector("#AolHtml5Player");r&&(r.style.width="100%",r.style.height="100%")}}function p(){i.addFullScreenEventLisener(f)}function m(){i.removeFullScreenEventLisener(f)}function y(t){var i={getVidiblePlayer:function(){return t},pause:function(){t.pause()},play:function(){t.play()},replay:function(){e.autoplay=!0,E(e.videoId)},mute:function(){t.mute()},unmute:function(){e.player.isMuted()&&t.mute()},getVolume:function(){return t.getPlayerInfo().volume},isMuted:function(){var e=t.getPlayerInfo().volume;return void 0===e||null==e?void 0:0===t.getPlayerInfo().volume}};e.player=i,d(i,t);var r=s(i);p(),i.destroy=function(){n.cancel(r),m(),v()}}function E(n){v(),t.queueForProcessing(n,e.autoplay,o,y)}var b=o[0].id||c.playerId||"page-unique-vidible-id-"+l++;o[0].id=b;var g=e.$watch(function(){return"undefined"!=typeof e.videoId},function(n){n&&(g(),e.$watch("videoId",function(){if(i.isInFullScreen()){var n=function(){i.removeFullScreenEventLisener(n),E(e.videoId)};i.addFullScreenEventLisener(n)}else E(e.videoId)}))});e.$on("$destroy",function(){v()})}}}])}(angular);